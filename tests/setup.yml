---

- name: launch docker containers
  hosts: local
  gather_facts: false
  roles:
    - role: chrismeyersfsu.provision_docker

- name: install epel and configure sudo for centos containers
  hosts: containers:&centos
  roles:
    - role: geerlingguy.repo-epel
  post_tasks:
    - name: make sure sudo is installed
      yum:
        name: sudo
        state: present
    - name: enable sudo with no password for wheel group
      copy:
        content: '%wheel ALL=(ALL) NOPASSWD: ALL'
        dest: /etc/sudoers.d/sudo_wheel
        mode: 0440
        owner: root
        group: root
    - name: install ius community repo
      yum:
        name: https://centos{{ansible_distribution_major_version}}.iuscommunity.org/ius-release.rpm
        state: present
    - name: install python35 from ius
      yum:
        name: python35u
        state: present

- name: check and install python on ubuntu containers
  hosts: containers:&ubuntu
  gather_facts: false
  tasks:
    - name: check for and install python
      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
    - name: install ca certificates
      apt:
        name: ca-certificates
    - name: make sure sudo is installed
      apt:
        name: sudo
        state: present
    - name: enable sudo with no password for sudo group
      copy:
        content: '%sudo ALL=(ALL) NOPASSWD: ALL'
        dest: /etc/sudoers.d/sudo_nopasswd
        mode: 0440
        owner: root
        group: root
    - name: install deadsnakes repo on ubuntu 14
      apt_repository:
        repo: ppa:fkrull/deadsnakes
        state: present
      when: inventory_hostname == "virtualenv_ubuntu14"
    - name: install python 3.5 on ubuntu 14
      apt:
        name: python3.5
        state: present
        update_cache: yes
      when: inventory_hostname == "virtualenv_ubuntu14"

- name: test connection to containers
  hosts: containers
  tasks:
    - name: ping it
      action: ping
